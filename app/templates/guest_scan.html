{% extends "base.html" %}

{% block content %}
<div class="card p-4">
    <h3 class="text-center mb-4">Гостевой сканер</h3>
    
    <div id="reader" style="width: 100%; max-width: 500px; margin: 0 auto; border-radius: 12px; overflow: hidden;"></div>
    
    <div class="mt-3 text-center">
        <input type="text" id="manual-input" class="form-control d-inline-block w-75" placeholder="Или введите штрих-код вручную">
        <button onclick="searchBarcode()" class="btn btn-primary ms-2">Поиск</button>
    </div>
</div>

<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script>
    const html5QrCode = new Html5Qrcode("reader");
    const config = { fps: 10, qrbox: { width: 250, height: 250 } };

    html5QrCode.start(
        { facingMode: "environment" },
        config,
        (decodedText) => {
            document.getElementById('manual-input').value = decodedText;
            html5QrCode.stop().then(() => {
                window.location.href = '/guest_equipment/' + decodedText;
            });
        },
        () => {}
    ).catch((err) => {
        document.getElementById('reader').innerHTML = `<p class="text-danger">Камера недоступна: ${err}</p>`;
    });

    function searchBarcode() {
        const barcode = document.getElementById('manual-input').value.trim();
        if (barcode) {
            window.location.href = '/guest_equipment/' + barcode;
        }
    }
</script>
{% endblock %}